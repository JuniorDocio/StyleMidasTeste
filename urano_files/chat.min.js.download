var nome="",telefone="",email="",cont=0,i=0,j=0,tem_tag_ads=0,nome_secretaria="Ana",nome_campo_corrente="nome",msg_processamento="Aguarde um momento por favor enquanto processamos sua solicitação.",msg_sucesso="Agradeço muito sua atenção, nosso especialista fará contato o mais rápido possível. Até breve.",perguntas_iniciais=["Olá! Meu nome é "+nome_secretaria+", sou secretária do setor comercial. ","Não possuímos no momento nenhum operador que possa lhe atender.","Anotarei seus dados e passarei o recado de forma que no menor espaço de tempo possível, um especialista irá contatá-lo.","Por favor, me informe seu nome."],total=perguntas_iniciais.length,texto_terceiro_balao="Qual o seu telefone com DDD? <br><small>(informe apenas números)</small>",texto_quarto_balao="Qual o seu email de contato?",texto_quinto_balao="Para melhor atendê-lo, favor me informar seu objetivo:";texto_quinto_balao+='<br><div class="form-check"><label class="form-check-label"><input type="radio" class="form-check-input" name="opcao_contato" value="1" data-filial="id_filial_aval_cmp" onchange="escolha_contato(this);">Vender meu imóvel</label></div><div class="form-check"><label class="form-check-label"><input type="radio" class="form-check-input" name="opcao_contato" value="2" data-filial="id_filial_aval_loc" onchange="escolha_contato(this);">Alugar meu imóvel</label></div><div class="form-check"><label class="form-check-label"><input type="radio" class="form-check-input" name="opcao_contato" value="3" data-filial="id_filial_int_cmp" onchange="escolha_contato(this);">Comprar imóvel avulso</label></div><div class="form-check"><label class="form-check-label"><input type="radio" class="form-check-input" name="opcao_contato" value="4" data-filial="id_filial_int_cmp" onchange="escolha_contato(this);">Comprar imóvel novo</label></div><div class="form-check"><label class="form-check-label"><input type="radio" class="form-check-input" name="opcao_contato" value="5" data-filial="id_filial_int_loc" onchange="escolha_contato(this);">Alugar um imóvel</label></div>';var filiais=[],retorno_secretaria_ativo="",secretaria_virtual_email_retorno="",id_lead_sv="";if("localhost"===location.hostname||"127.0.0.1"===location.hostname)var caminho_ajax="secretaria/ajax.php",caminho_css="secretaria/css/style.css",caminho_img="secretaria/img/secretaria.jpg";else if("https://midas360.imb.br/secretaria_virtual_homologacao/index.php"==window.location.href||"http://midas360.imb.br/secretaria_virtual_homologacao/index.php"==window.location.href||"http://midas360.imb.br/secretaria_virtual_homologacao/"==window.location.href||"https://midas360.imb.br/secretaria_virtual_homologacao/"==window.location.href)var caminho_ajax="https://midas360.imb.br/secretaria_virtual_homologacao/ajax.php",caminho_css="https://midas360.imb.br/secretaria_virtual_homologacao/css/style.css",caminho_img="https://midas360.imb.br/secretaria_virtual_homologacao/img/secretaria.jpg";else var caminho_ajax="https://midas360.imb.br/secretaria_virtual/ajax.php",caminho_css="https://midas360.imb.br/secretaria_virtual/css/style.css",caminho_img="https://midas360.imb.br/secretaria_virtual/img/secretaria.jpg";function escolha_contato(elem){var escolha=$(elem),escolhaBD=escolha.data("filial");$(".body-chat").html(""),cria_carregando(),setTimeout((function(){insere_msg(msg_processamento)}),1500);var email_remetente=filiais.length>0?filiais[escolhaBD].email_remetente:"",email_copia=filiais.length>0?filiais[escolhaBD].email_copia:"",id_filial=filiais.length>0?filiais[escolhaBD].id_filial:"",codigo_cliente=$("#chatMidas").data("codigo-cliente"),jqxhr=$.post(caminho_ajax,{envia_email:"s",id_lead_sv:id_lead_sv,nome:nome,contato:email,escolha_contato:escolha.val(),telefone:telefone,codigo_cliente:codigo_cliente,email_remetente:email_remetente,email_copia:email_copia,id_filial:id_filial,retorno_secretaria_ativo:retorno_secretaria_ativo,secretaria_virtual_email_retorno:secretaria_virtual_email_retorno},(function(data,status,xhr){var obj=JSON.parse(data);if($(".body-chat").html(""),"sucesso"==obj.status){console.log("Email enviado e registro feito."),cria_carregando(),setTimeout((function(){insere_msg(msg_sucesso)}),1500);var url_atual=window.location.href;setTimeout((function(){gtag_report_conversion(url_atual)}),2e3)}else console.log(obj.msg)})).done((function(){})).fail((function(){console.log("Ocorreu um erro ao fazer a requisição")})).always((function(){}))}function fechar_chat(){var chat=$("#chatMidas"),chamaChat=$("#chamaChat");limpa_input(),zera_vars(),chat.hide(),chamaChat.show(),libera_cliente()}function enviar_msg_chat(){var msg=$("#mensagem_a_enviar"),chat=$(".body-chat"),retorno_valida=!0;if(msg.val()){switch(aguarda_servidor(),cont){case 0:nome=msg.val();break;case 1:retorno_valida=valida(telefone=msg.val(),"telefone"),nome_campo_corrente="Telefone";break;case 2:retorno_valida=valida(email=msg.val(),"email"),nome_campo_corrente="Email"}if(1==retorno_valida){var msg_html=msg_html_cliente(msg.val());chat.append(msg_html),retorno_msg_digitada(++cont),limpa_input(),joga_no_bottom(),libera_cliente(),"Telefone"==nome_campo_corrente&&registra_parcial()}else alert(nome_campo_corrente+" inválido."),libera_cliente()}cont>=3&&aguarda_servidor()}function inicializa_chat(){setTimeout((function(){cria_carregando(),setTimeout((function(){insere_msg(perguntas_iniciais[j]),j++}),1500),++i<total?inicializa_chat():libera_cliente()}),2e3)}function cria_carregando(){var msg1="";return elemento=msg_html_servidor(""),elemento=$(elemento),elemento.addClass("loading"),$(".body-chat").append(elemento),joga_no_bottom()}function insere_msg(msg){return $(".loading").last().remove(),elemento2=msg_html_servidor(msg),elemento2=$(elemento2),$(".body-chat").append(elemento2),joga_no_bottom()}function chama_chat_inicial(){var chat;$("#chamaChat").hide(),$("#chatMidas").show(),$("#mensagem_a_enviar").prop("disabled",!0),$(".guarda-chat").show();var corpo_chat=$(".body-chat");limpa_input(),zera_vars(),corpo_chat.html(""),inicializa_chat()}function retorno_msg_digitada(){var corpo_chat=$(".body-chat");if(cont<=3){switch(cont){case 1:var msg_secretaria=texto_terceiro_balao;break;case 2:var msg_secretaria=texto_quarto_balao;break;case 3:var msg_secretaria=texto_quinto_balao}cria_carregando(),setTimeout((function(){insere_msg(msg_secretaria)}),1500)}}function msg_html_cliente(msg){return'<span class="border rounded-lg balao-conversa align-self-end">'+msg+"</span>"}function msg_html_servidor(msg){return'<span class="border rounded-lg balao-conversa align-self-start">'+msg+"</span>"}function joga_no_bottom(){const messages=document.getElementsByClassName("body-chat")[0];messages.scrollTop=messages.scrollHeight}function limpa_input(){$("#mensagem_a_enviar").val("")}function zera_vars(){cont=0,i=0,j=0,nome_campo_corrente="Nome",nome="",telefone="",email="",id_lead_sv=""}function aguarda_servidor(){$("#mensagem_a_enviar").prop("disabled",!0),$("#envia-chat").hide()}function libera_cliente(){$("#mensagem_a_enviar").prop("disabled",!1),cont<=2&&$("#mensagem_a_enviar").focus(),$("#envia-chat").show()}function alimenta_chat(titulo){var chamaChat='<div id="chamaChat" class="chamaChat" onclick="chama_chat_inicial();" data-toggle="tooltip" title="Secretária Virtual"><span><img src="https://midas360.imb.br/secretaria_virtual/img/fone.png" alt="Smiley face" height="42" width="42" data-toggle="tooltip" data-placement="top" title="Secretária Virtual"></span></div>';$("body").append(chamaChat);var estrutura='<section class="container-chat"><section class="guarda-chat"><header class="header-chat"><section class="chat-header-pt1"><section class="atendente"><img src="'+caminho_img+'" style="width:40px; height:40"/></section><section class="titulo-chat"><h5>'+nome_secretaria+'</h5><span>Secretária Virtual</span></section></section><section class="chat-header-pt2 text-right"><span id="fecha-chat" onclick="fechar_chat();"><b>X</b></span></section></header><article class="body-chat d-flex flex-column"></article><article class="guarda-input-chat d-flex p-3 align-items-center"><textarea id="mensagem_a_enviar" class="form-control" rows="2"></textarea><span id="envia-chat" onclick="enviar_msg_chat();">Enviar</span></article></section></section>';document.getElementById("chatMidas").innerHTML=estrutura}function carregaChat(){var link='<link rel="stylesheet"></link>';(link=$(link)).attr("href",caminho_css),$("head").append(link);var codigo_cliente=$("#chatMidas").data("codigo-cliente");if(null==codigo_cliente)return!1;var nome_cliente=$("#chatMidas").data("nome-cliente"),titulo="Soluções Midas";null!=nome_cliente&&(titulo=nome_cliente);var jqxhr=$.post(caminho_ajax,{busca_cliente:codigo_cliente},(function(data,status,xhr){var obj=JSON.parse(data);"sucesso"==obj.status?(filiais=obj.filiais,retorno_secretaria_ativo=obj.retorno_secretaria_ativo,secretaria_virtual_email_retorno=obj.secretaria_virtual_email_retorno,dadosCustomizacaoSecretaria=obj.customizacaoSecretaria,console.log(dadosCustomizacaoSecretaria),customizaSecretaria(dadosCustomizacaoSecretaria),alimenta_chat(titulo)):console.log(obj.msg)})).done((function(){})).fail((function(){console.log("ocorreu um erro ao fazer a requisição")})).always((function(){}))}function valida(valor,tipo){switch(tipo){case"telefone":return!(valor.length<10||valor.length>12||isNaN(valor));case"email":var re;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(valor).toLowerCase())}}function registra_parcial(){var codigo_cliente=$("#chatMidas").data("codigo-cliente"),jqxhr=$.post(caminho_ajax,{contato_parcial:"s",nome:nome,telefone:telefone,codigo_cliente:codigo_cliente},(function(data,status,xhr){var obj=JSON.parse(data);"sucesso"==obj.status&&(id_lead_sv=obj.id_lead_sv)})).done((function(){})).fail((function(){console.log("Ocorreu um erro ao fazer a requisição")})).always((function(){}))}function customizaSecretaria(customizacaoSecretaria){if(""!==customizacaoSecretaria.tag_conversao_ads&&void 0!==customizacaoSecretaria.tag_conversao_ads){tem_tag_ads=1;var tag='<script async src="https://www.googletagmanager.com/gtag/js?id='+customizacaoSecretaria.tag_conversao_ads+'"><\/script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag("js", new Date()); gtag("config", "'+customizacaoSecretaria.tag_conversao_ads+'"); <\/script>';$("head").append(tag);var tagPt2='<script> function gtag_report_conversion(url) { var callback = function () { if (typeof(url) != "undefined") { window.location = url; } }; gtag("event", "conversion", { "send_to": "'+customizacaoSecretaria.tag_conversao_ads+'/u8SSCObH_qQBEIH1jaED", "event_callback": callback }); return false; } <\/script>';$("head").append(tagPt2)}""!==customizacaoSecretaria.secretaria_nome_apresentacao&&void 0!==customizacaoSecretaria.secretaria_nome_apresentacao&&(nome_secretaria=customizacaoSecretaria.secretaria_nome_apresentacao),""!==customizacaoSecretaria.secretaria_nome_foto&&void 0!==customizacaoSecretaria.secretaria_nome_foto&&(caminho_img=customizacaoSecretaria.secretaria_nome_foto),""!==customizacaoSecretaria.secretaria_introducao_1&&void 0!==customizacaoSecretaria.secretaria_introducao_1&&(secretaria_introducao_1=customizacaoSecretaria.secretaria_introducao_1,perguntas_iniciais[0]=secretaria_introducao_1),""!==customizacaoSecretaria.secretaria_introducao_2&&void 0!==customizacaoSecretaria.secretaria_introducao_2&&(secretaria_introducao_2=customizacaoSecretaria.secretaria_introducao_2,perguntas_iniciais[1]=secretaria_introducao_2),""!==customizacaoSecretaria.secretaria_introducao_3&&void 0!==customizacaoSecretaria.secretaria_introducao_3&&(secretaria_introducao_3=customizacaoSecretaria.secretaria_introducao_3,perguntas_iniciais[2]=secretaria_introducao_3)}function alteraIconeSecretaria(){largura=window.innerWidth,largura,$("#chamaChat").css("bottom","150px")}largura=window.innerWidth,$("#chamaChat").css("bottom","180px"),alteraIconeSecretaria(),$(window).resize((function(){alteraIconeSecretaria()})),$("#chamaChat").css("bottom","180px"),$('[data-toggle="tooltip"]').tooltip(),$((function(){setTimeout((function(){$("#chamaChat").css("bottom","180px"),alteraIconeSecretaria(),$('[data-toggle="tooltip"]').tooltip()}),200)})),$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip(),setTimeout((function(){$('[data-toggle="tooltip"]').tooltip()}),3e3)}));